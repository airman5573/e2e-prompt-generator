(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const A="attributePreferences",l=["id","class"],a={builtInAttributes:["id"],customAttributes:[]},C='input[name="attribute"]';let i=c(a);function f(t){return typeof t=="string"?t.trim():""}function h(t){return/^[a-zA-Z_][a-zA-Z0-9_\-:.]*$/.test(t)}function c(t){if(Array.isArray(t)){const o=[],u=[];return t.forEach(L=>{const E=f(L);if(!E)return;const m=E.toLowerCase();if(l.includes(m)){o.push(m);return}h(m)&&u.push(m)}),{builtInAttributes:p(o),customAttributes:I(u)}}if(!t||typeof t!="object")return{builtInAttributes:[...a.builtInAttributes],customAttributes:[...a.customAttributes]};const e=Array.isArray(t.builtInAttributes)?t.builtInAttributes:[],r=Array.isArray(t.customAttributes)?t.customAttributes:[],s=p(e.map(o=>f(o).toLowerCase()).filter(o=>l.includes(o))),n=I(r.map(o=>f(o).toLowerCase()).filter(o=>o&&h(o)).filter(o=>!l.includes(o)));return{builtInAttributes:s,customAttributes:n}}function I(t){const e=new Set,r=[];return t.forEach(s=>{const n=s.toLowerCase();e.has(n)||(e.add(n),r.push(s))}),r}function p(t){const e=new Set((t||[]).map(s=>s.toLowerCase()).filter(s=>s)),r=l.filter(s=>e.has(s));return r.length?r:[...a.builtInAttributes]}function v(){return Array.from(document.querySelectorAll(C))}function y(t){const e=new Set(t);v().forEach(r=>{r.checked=e.has(r.value)})}function b(t){const e=document.getElementById("custom-attributes-list"),r=document.getElementById("custom-attributes-empty-state");if(!(!e||!r)){if(e.innerHTML="",!t.length){r.classList.remove("hidden");return}r.classList.add("hidden"),t.forEach(s=>{const n=document.createElement("li");n.className="custom-attribute-item";const o=document.createElement("span");o.className="custom-attribute-name",o.textContent=s;const u=document.createElement("button");u.type="button",u.className="custom-attribute-remove",u.textContent="Remove",u.addEventListener("click",()=>N(s)),n.appendChild(o),n.appendChild(u),e.appendChild(n)})}}function d(t){const e=document.getElementById("status");e&&(e.textContent=t,e.classList.add("visible"),setTimeout(()=>{e.classList.remove("visible")},1800))}function B(){const t=v().filter(e=>e.checked).map(e=>e.value).filter(e=>l.includes(e));return p(t)}function S(){const t=v();if(t.some(n=>n.checked))return;const r=a.builtInAttributes[0],s=t.find(n=>n.value===r)||t[0];s&&(s.checked=!0),d("Keep at least one built-in attribute selected.")}function w(t){const e=f(t);if(!e)return{valid:!1,reason:"Enter an attribute name."};const r=e.toLowerCase();return h(r)?l.some(s=>s===r)?{valid:!1,reason:"ID and Class are already available as built-in attributes."}:i.customAttributes.some(s=>s===r)?{valid:!1,reason:"That attribute is already in your list."}:{valid:!0,value:r}:{valid:!1,reason:'Attribute names must start with a letter or underscore and use letters, numbers, "-", "_", ":", or ".".'}}function g(t,e="Saved!"){if(!chrome?.storage?.sync){d("Storage unavailable.");return}const r=c(t);i=r,chrome.storage.sync.set({[A]:r},()=>{if(chrome.runtime?.lastError){d("Failed to save, try again.");return}d(e)})}function k(t){t?.preventDefault();const e=document.getElementById("custom-attribute-input");if(!e)return;const r=w(e.value);if(!r.valid){d(r.reason),e.focus();return}const s={...i,customAttributes:[...i.customAttributes,r.value]};i=c(s),b(i.customAttributes),g(i,"Added custom attribute."),e.value="",e.focus()}function N(t){const e=t.toLowerCase(),r=i.customAttributes.filter(s=>s.toLowerCase()!==e);r.length!==i.customAttributes.length&&(i=c({...i,customAttributes:r}),b(i.customAttributes),g(i,"Removed custom attribute."))}function O(){if(!chrome?.storage?.sync){i=c(a),y(i.builtInAttributes),b(i.customAttributes);return}chrome.storage.sync.get([A],t=>{chrome.runtime?.lastError?(i=c(a),d("Using default settings due to a loading error.")):i=c(t?.[A]),y(i.builtInAttributes),b(i.customAttributes)})}document.addEventListener("DOMContentLoaded",()=>{O();const t=document.getElementById("options-form");t&&t.addEventListener("change",s=>{!(s.target instanceof HTMLInputElement)||s.target.type!=="checkbox"||S()});const e=document.getElementById("save-button");e&&e.addEventListener("click",()=>{const s=B();i=c({builtInAttributes:s,customAttributes:i.customAttributes}),y(i.builtInAttributes),g(i,"Saved!")});const r=document.getElementById("custom-attribute-form");r&&r.addEventListener("submit",k)});
